<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Browser Test</title>
</head>
<body>
  <script src="../dist/bundle.min.js"></script>
  <script type="module">
    const { NostrClient, KeyPair } = window.nostrEmitter

    console.log(window.nostrEmitter)

    // Create a random keypair, or use a secret phrase.
    const { prvkey, pubkey } = KeyPair.random()

    // Optional: Self-published events are filtered
    // out by default, but let's enable them for testing.
    const config = { selfsub: true }

    // Now we can create a type-safe client emitter.
    const client = new NostrClient(prvkey, config)

    client.on('ready', (emitter) => {
      // The ready event is emitted by the client once
      // it is connected and subscribed to a relay.

      console.log('Connected to ' + emitter.client.address)

      // Example of how to broadcast an event.
      emitter.relay('helloEvent', { name: 'Bob', location: 'Panama' })
    })

    // The address of the relay.
    const address = 'wss://relay-pub.deschooling.us'
    // Optional: You can provide a secret for encrypting messages!
    const secret  = 'thisisatestpleaseignore'
    // The connect method returns an emitter object for our events.
    const emitter = await client.connect(address, secret)

    // Register an event listener.
    emitter.on('helloEvent', (data, event) => {
      console.log(`Hello from ${data.name} in ${data.location}!`)
      console.log(`Sent from pubkey: ${event.pubkey}`)
      console.log(`Event Payload:`, JSON.stringify(event, null, 2))
    })
  </script>
</body>
</html>
